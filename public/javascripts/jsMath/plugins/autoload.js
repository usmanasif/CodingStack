/*  Copyright 2004-2006 by Davide P. Cervone
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

if(!window.jsMath)window.jsMath={};if(jsMath.Autoload==null)jsMath.Autoload={};jsMath.Add=function(a,b){for(var c in b)a[c]=b[c]};jsMath.document=document;
jsMath.Add(jsMath.Autoload,{Script:{request:null,iframe:null,operaXMLHttpRequestBug:window.opera!=null,Init:function(){this.Root();if(window.XMLHttpRequest){try{this.request=new XMLHttpRequest}catch(a){}if(this.request&&window.location.protocol=="file:")try{this.request.open("GET",jsMath.Autoload.root+"plugins/autoload.js",false);this.request.send(null)}catch(b){this.request=null;if(window.postMessage&&window.addEventListener){this.mustPost=1;window.addEventListener("message",jsMath.Autoload.Post.Listener,
false)}}}if(!this.request&&window.ActiveXObject&&!this.mustPost)for(var c=["MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],d=0;d<c.length&&!this.request;d++)try{this.request=new ActiveXObject(c[d])}catch(e){}},Load:function(a){this.request&&!(this.operaXMLHttpRequestBug&&a=="jsMath.js")?setTimeout(function(){jsMath.Autoload.Script.xmlLoad(a)},1):this.startLoad(a)},xmlLoad:function(a){try{this.request.open("GET",jsMath.Autoload.root+a,false);this.request.send(null)}catch(b){throw Error("autoload: can't load the file '"+
a+"'\nMessage: "+b.message);}if(this.request.status&&this.request.status>=400)throw Error("autoload: can't load the file '"+a+"'\nError status: "+this.request.status);window.eval(this.request.responseText);this.endLoad()},startLoad:function(a){this.iframe=document.createElement("iframe");this.iframe.style.visibility="hidden";this.iframe.style.position="absolute";this.iframe.style.width="0px";this.iframe.style.height="0px";document.body.firstChild?document.body.insertBefore(this.iframe,document.body.firstChild):
document.body.appendChild(this.iframe);this.url=a;setTimeout("jsMath.Autoload.Script.setURL()",100)},endLoad:function(){setTimeout("jsMath.Autoload.Script.AfterLoad()",1)},setURL:function(){if(this.mustPost)this.iframe.src=jsMath.Autoload.Post.startLoad(this.url,this.iframe);else{var a=jsMath.Autoload.root+"jsMath-autoload.html",b=this.iframe.contentDocument;if(!b&&this.iframe.contentWindow)b=this.iframe.contentWindow.document;if(navigator.vendor=="Apple Computer, Inc."&&document.location.protocol==
"file:")b=null;if(b)b.location.replace(a);else this.iframe.src=a}},queue:[],Push:function(a,b){this.queue[this.queue.length]=[a,b]},RunStack:function(){if(this.tex2math)jsMath.Autoload.Check2();else{for(var a=0;a<this.queue.length;a++){var b=this.queue[a][0],c=this.queue[a][1];c.length==1?jsMath[b](c[0]):jsMath[b](c[0],c[1],c[2],c[3])}this.queue=[]}},AfterLoad:function(){jsMath.Autoload.Script.RunStack()},Root:function(){if(!jsMath.Autoload.root){var a=document.getElementsByTagName("script");if(a)for(var b=
0;b<a.length;b++){var c=a[b].src;if(c&&c.match("(^|/|\\\\)plugins/autoload.js$")){jsMath.Autoload.root=c.replace(/plugins\/autoload.js$/,"");break}}}}},Post:{window:null,Listener:function(a){if(a.source==jsMath.Autoload.Post.window){var b=a.origin.replace(/^file:\/\//,""),c=document.domain.replace(/^file:\/\//,"");if(b==null||b==""||b=="null")b="localhost";if(c==null||c==""||c=="null")c="localhost";if(!(b!=c||a.data.substr(0,6)!="jsMAL:")){b=a.data.substr(6,3).replace(/ /g,"");a=a.data.substr(10);
jsMath.Autoload.Post.Commands[b]&&jsMath.Autoload.Post.Commands[b](a)}}},Commands:{SCR:function(a){window.eval(a)},ERR:function(){jsMath.Autoload.Script.endLoad()},END:function(){jsMath.Autoload.Script.endLoad()}},startLoad:function(a,b){this.window=b.contentWindow;return jsMath.Autoload.root+"jsMath-loader-post.html?autoload="+a},endLoad:function(){this.window=null}},Check:function(){if(!this.checked){this.checked=1;if((this.findTeXstrings||this.findLaTeXstrings||this.findCustomStrings||this.findCustomSettings)&&
(!jsMath.tex2math||!jsMath.tex2math.loaded)){this.Script.tex2math=1;this.Script.Load("plugins/tex2math.js")}else{if(!jsMath.tex2math)jsMath.tex2math={};this.Check2()}}},ReCheck:function(){if(!jsMath.loaded){this.InitStubs();this.checked=0;this.Script.queue=[];this.Check()}},Check2:function(){this.needsJsMath=this.Script.tex2math=0;if(this.checkElement==null)this.checkElement=null;this.findTeXstrings&&jsMath.tex2math.ConvertTeX(this.checkElement);this.findLaTeXstrings&&jsMath.tex2math.ConvertLaTeX(this.checkElement);
this.findCustomSettings&&jsMath.tex2math.Convert(this.checkElement,this.findCustomSettings);if(this.findCustomStrings){var a=this.findCustomStrings;jsMath.tex2math.CustomSearch(a[0],a[1],a[2],a[3]);jsMath.tex2math.ConvertCustom(this.checkElement)}if(this.needsJsMath=this.areMathElements(this.checkElement))this.LoadJsMath();else{jsMath.Process=function(){};jsMath.ProcessBeforeShowing=function(){};jsMath.ProcessElement=function(){};jsMath.ConvertTeX=function(){};jsMath.ConvertTeX2=function(){};jsMath.ConvertLaTeX=
function(){};jsMath.ConvertCustom=function(){};jsMath.CustomSearch=function(){};jsMath.Macro=function(){};jsMath.Synchronize=function(b,c){typeof b=="string"?eval(b):b(c)};jsMath.Autoload.Script.RunStack();jsMath.Autoload.setMessage()}},tex2mathCallback:function(){jsMath.Autoload.needsJsMath=1;return false},Run:function(){},areMathElements:function(a){a||(a=document);if(typeof a=="string")a=document.getElementById(a);if(!a.getElementsByTagName)return false;for(var b=a.getElementsByTagName("div"),
c=0;c<b.length;c++)if(b[c].className.match(/(^| )math( |$)/))return true;b=a.getElementsByTagName("span");for(c=0;c<b.length;c++)if(b[c].className.match(/(^| )math( |$)/))return true;return false},LoadJsMath:function(){if(!this.loading)if(jsMath.loaded)this.afterLoad();else if(this.root){this.loading=1;this.setMessage("Loading jsMath...");this.Script.AfterLoad=this.afterLoad;this.Script.Load("jsMath.js")}else alert("Can't determine URL for jsMath.js")},afterLoad:function(){jsMath.Autoload.loading=
0;if(jsMath.tex2math.window)jsMath.tex2math.window.jsMath=jsMath;if(jsMath.browser=="MSIE")window.onscroll=jsMath.window.onscroll;var a=jsMath.Autoload.loadFonts;if(a){if(typeof a!="object")a=[a];for(var b=0;b<a.length;b++)jsMath.Font.Load(a[b])}if(a=jsMath.Autoload.loadFiles){if(typeof a!="object")a=[a];for(b=0;b<a.length;b++)jsMath.Setup.Script(a[b])}if(b=jsMath.Autoload.macros)for(var c in b)typeof b[c]=="string"?jsMath.Macro(c,b[c]):jsMath.Macro(c,b[c][0],b[c][1]);jsMath.Synchronize(function(){jsMath.Autoload.Script.RunStack()});
jsMath.Autoload.setMessage()},setMessage:function(a){if(a){this.div=document.createElement("div");document.body.hasChildNodes?document.body.insertBefore(this.div,document.body.firstChild):document.body.appendChild(this.div);var b={position:"fixed",bottom:"1px",left:"2px",backgroundColor:"#E6E6E6",border:"solid 1px #959595",margin:"0px",padding:"1px 8px",zIndex:102,color:"black",fontSize:"75%",width:"auto"};for(var c in b)this.div.style[c]=b[c];this.div.id="jsMath_message";this.div.appendChild(jsMath.document.createTextNode(a))}else if(this.div){this.div.firstChild.nodeValue=
"";this.div.style.visibility="hidden"}},stubs:{Process:function(a){jsMath.Autoload.Script.Push("Process",[a])},ProcessBeforeShowing:function(a){jsMath.Autoload.Script.Push("ProcessBeforeShowing",[a])},ProcessElement:function(a){jsMath.Autoload.Script.Push("ProcessElement",[a])},ConvertTeX:function(a){jsMath.Autoload.Script.Push("ConvertTeX",[a])},ConvertTeX2:function(a){jsMath.Autoload.Script.Push("ConvertTeX2",[a])},ConvertLaTeX:function(a){jsMath.Autoload.Script.Push("ConvertLaTeX",[a])},ConvertCustom:function(a){jsMath.Autoload.Script.Push("ConvertCustom",
[a])},CustomSearch:function(a,b,c,d){jsMath.Autoload.Script.Push("CustomSearch",[a,b,c,d])},Synchronize:function(a){jsMath.Autoload.Script.Push("Synchronize",[a])},Macro:function(a,b,c){jsMath.Autoload.Script.Push("Macro",[a,b,c])}},InitStubs:function(){jsMath.Add(jsMath,jsMath.Autoload.stubs)}});if(jsMath.Autoload.findTeXstrings==null)jsMath.Autoload.findTeXstrings=0;if(jsMath.Autoload.findLaTeXstrings==null)jsMath.Autoload.findLaTeXstrings=0;jsMath.Autoload.Script.Init();jsMath.Autoload.InitStubs();
document.body&&!jsMath.Autoload.delayCheck&&jsMath.Autoload.Check();